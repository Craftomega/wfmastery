<script>
var raw_str="011111111111111111111111111111121111111111111111111111101111111011111111111111110010111100011100100000010000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";

var hell_str = Array(525).fill(9).join("");
var clean_str = raw_str.replace(/0+$/, '');

//console.log(raw_str);
//console.log(raw_str.length, clean_str.length);

function diff_strs(a, b){
    for(let i = 0; i < a.length; i++){
        if(a[i] !== b[i]) {
            console.log(i, a[i], b[i], a[i] !== b[i]);
        }
    }
}

function test_wrap(tests){

    for(let test of tests){

        console.log("New test", test.length);
        {
            console.group("10 to 32");

            console.group("Compress");
            let cstr = compress(test, 10, 32);
            console.log("result", cstr.length, cstr);
            console.groupEnd();

            console.group("Decompress");
            let dstr = decompress(cstr, 32, 10, 3, test.length);
            console.groupEnd();

            console.log("result", dstr.length, dstr == test);
            if(dstr != test) {
                console.group("Comparison test");
                diff_strs(test, dstr);
                console.groupEnd();
            }

            console.groupEnd();
        }
        continue;

        {
            console.group("10 to unicode");

            console.group("ucompress");
            let cstr = ucompress(test);
            console.log("result new size", cstr.length, "new str", cstr);
            console.groupEnd();

            console.group("Unicode to 10");
            let dstr = udecompress(cstr, 6, test.length);

            console.groupEnd();

            console.log("Result", dstr.length, dstr, dstr == test);
            if(dstr != test) {
                diff_strs(test, dstr);
            }

            console.groupEnd();
        }




    }

}

function compress(str, from, to, chunk_size = 4){
    var chunks,
        new_chunks = [],
        new_str = ""
        ;

    chunks = str.match(new RegExp(`.\{0,${chunk_size}\}`, "g"));


    for(let chunk of chunks) {

        let temp_str = "";
        if(chunk.length === 0){
            temp_str = "0";
        } else {
            temp_str = parseInt(chunk, from).toString(to); //Yes we're going to base 36, probably go to 27*2+9 (a-Z+0-9) but that's a bit too much
        }

        new_chunks.push(temp_str);
        console.log(temp_str.length, chunk.length, chunk, temp_str);
    }
    return new_chunks.join(":");
}

function decompress(str, from, to, size, max_len) {
    let chunks = str.split(":"),
        new_chunks = [],
        new_str = "",
        pad_str = Array(size).fill(0).join("");


    for(let chunk of chunks){
        let temp_str = "";
        temp_str = parseInt(chunk, from).toString(to);
        temp_str = pad_str.substring(0, pad_str.length-temp_str.length)+temp_str;

        console.log(chunk, temp_str, temp_str.length);


        new_str += temp_str;
    }

    return new_str.substring(0, max_len);


}





function ucompress(str){
    var new_chunks = [],
        new_str;

        //Unicode maxes out at 0xFFFF so to be safe grab 4 blocks at a time
        // which if the math in my head is ~65532?
        // 65532
        //  9999
        // would fit but
        // 99999
        // would overflow (does Javascript overflow?)
        //so chunks of 4 at a time is safe

        for(let chunk of str.match(/.{0,3}/g)){
            let temp_var = parseInt(chunk),
                abuse = (isNaN(temp_var) ? 0 : `0${temp_var}` + 0),
                temp_str = String.fromCharCode(abuse);
            new_chunks.push(temp_str);


            //console.log(new_chunks.length, chunk, temp_var, abuse, temp_str);
        }

        return new_chunks.join("");

}

function udecompress(str, max_len){
    var new_chunks = [];

    for(let i = 0 ; i < str.length; i++) {
        let temp_num = str.charCodeAt(i);
        console.log(temp_num, str[i]);
        new_chunks.push(temp_num + "");
    }


    console.log(new_chunks.join(":"));
    return new_chunks.join("").substring(0, max_len);
}



//var dictionary = Array((27*2)+9);
//for(var i = 0; i < 0;  )


test_wrap([raw_str, hell_str]);


</script>
