<style>

    * {
        z-index: 1;
    }

    body {
        margin: 0px;
    }

    .list {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        font-size: 1rem;
        padding-top: 9.8em;

    }



    .header {
        position: fixed;
        top: 3em;
        width: 100%;
        display: flex;
        flex-direction: row;
        justify-content: flex-start;
        background-color: rgba(255, 255, 255, 0.8);
        font-size: 1.4em;
        /*border-bottom: solid black thin;*/
        z-index: 10;
    }
    .subheader {
        position: fixed;
        top: 5em;
        width: 100%;
        display: flex;
        flex-direction: row;
        justify-content: flex-start;
        background-color: rgba(255, 255, 255, 0.8);
        font-size: 1.4em;
        border-bottom: solid black thin;
        z-index: 10;
    }

    .banner {
        position: fixed;
        top: -1em;
        width: 100%;
        height: 1em;
        text-align: center;
        padding: 1em;
        background-color: rgba(255, 255, 255, 0.9);
        z-index: 5;
    }

    .row {
        width: 100%;
        display: flex;
        flex-direction: row;
        justify-content: flex-start;
    }



    .row:nth-child(even):not(.hide) {
        background-color: lightgray;
    }

    .hide {
        display: none !important;
    }

    .cell {
        flex-grow: 1;
        text-align: left;
        flex-flow: row nowrap;
        flex-basis: 0;
        padding: 0.5em;
        word-break: break-word;
    }

    .killbox {
        color: red;
        border: solid black thin;
        border-radius: 15px;
        padding: 1px;
        font-size: 1rem;
    }



    .small {
        width: 2em;
        flex-grow: .3;
    }


    .smartbox {
        position: fixed;

        background-color: white;
        border: outset gray medium;
        padding: 2px;
        z-index: 11;

    }

    .smartbox h1 {
        margin: 0 auto;
        text-align: center;

    }

    .smartbox button {
        float: right;
    }

    .smartbox input {
        margin: 0px 10px 2px 10px;
        padding: 5px;
    }

    .smartbox ul {
        list-style: none;
        margin: 0px 10px 2px 10px;
        padding: 5px;
    }

    .smartbox li {
        padding: 4px 10px;
        text-align: center;
        cursor: pointer;
        outline: none;
        box-shadow: 0 9px #e1e4ea;
        border: outset medium gray;
        border-radius: 15px;
        margin-bottom: 9px;

    }
    .smartbox li:hover {
        background-color: #c6c9ce
    }

    .smartbox  li.active {
        background-color: darkgreen;
        color:white;
        box-shadow: 0 3px black;
        /*transform: translateY(2px);*/
    }

    .smartbox li:active {
        background-color: darkgreen;
        box-shadow: 0 3px black;
        transform: translateY(2px);
    }

    .smartbox .hide {
        animation-duration: 5s;
        animation: fadeout;
    }

    @keyframes fadeout {
        from {
            color: rgba(0,0,0,1);
        }

        to {
            color: rgba(256,256,256,0);
            display: none;
        }
    }







</style>

<h1 class="banner">Equipment</h1>
<div class="list">
    <div class="header">
        <span class="cell">Record ID</span>
        <span class="cell">Hidden</span>
        <span class="cell magic-string">Name</span>
        <span class="cell magic-string">Pretty name</span>
        <span class="cell magic-filter">Category</span>
        <span class="cell magic-filter">Subcategory</span>
        <span class="cell">Actions</span>
    </div>
    <div class="subheader">
        <span class="cell"></span>
        <span class="cell"></span>
        <span class="cell magic-string"></span>
        <span class="cell magic-string"></span>
        <span class="cell magic-filter"></span>
        <span class="cell magic-filter"></span>
        <span class="cell"></span>
    </div>
{%- macro cell(name, value) -%}
    <span class="cell" data-name="{{name}}" data-value="{{value}}">
{%-     if caller -%}
        {{caller()}}
{%-     else -%}
        {{value}}
{%-      endif -%}
    </span>
{%- endmacro %}

{%  for record in records %}
    <div class="row" data-record-id="{{record.id}}">
{%-      for field_name in ['id', 'hidden', 'name', 'pretty_name'] %}
        {{ cell(field_name, record[field_name]) }}
{%-      endfor %}
        <span class="cell">{{record.category.name}}</span>
        <span class="cell">{{record.subcategory.name}}</span>
        {% call cell("","") %}<a href="{{origin.base_url}}{{record.id}}">Edit</a>{% endcall %}
    </div>
{%  endfor %}
    <div class="tail">
        <span class="cell"></span>
        <span class="cell"></span>
        <span class="cell"></span>
        <span class="cell"></span>
        <span class="cell"></span>
        <span class="cell"></span>
        <span class="cell"></span>
    </div>
</div>


<script type="text/javascript" src="../static/utility.js"></script>
<script type="text/javascript" src="../static/magic_columns.js"></script>
<script>


    var list_classes = {row:"row", cell:"cell", header_row:"header"};
    var list_element = document.getElementsByClassName("list")[0];

    function ApplyMagic(classes, list){
        //Find the headers
        let magic_map = {}
        let headers = list.querySelectorAll(`.${classes.header_row} .${classes.cell}`)
        let subheaders = list.querySelectorAll(`.subheader .${classes.cell}`)

        for(var i = 0; i < headers.length; i++){
            let contains = str=>headers[i].classList.contains(str);

            let name = headers[i].innerHTML;

            if(contains("magic-string")) {
                magic_map[name] = new StringColumn(
                    list, i+1, list_classes
                )
            }
            else if(contains("magic-filter")) {
                magic_map[name] = new FilterColumn(
                    list, i+1, list_classes
                )
            }


            let blank_fill = Array(name.length+1).fill("&nbsp;").join("");
            //for(let si = 0; si < name.length; si++){
            //    blank_fill += "&nbsp;"
            //}

            subheaders[i].innerHTML = blank_fill;




        }

        return magic_map;
    }


    djw(x=>ApplyMagic(list_classes, list_element));

    //var magic_map = ApplyMagic(list_classes, list_element);

    //var category = new FilterColumn(
    //        list_element,
    //        5,
    //        list_classes);
    //
    //var name_regex = new StringColumn(
    //        list_element,
    //        3,
    //        list_classes
    //)
    //category.show_smart_box();
</script>
